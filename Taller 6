/*Creacion de tabla con valores asociados a las letras de las patentes*/
CREATE TABLE patentes(
	letras varchar(2),
	valor varchar(3)
);
COPY patentes FROM 'C:\Users\thech\Desktop\BD\taller6\ValoresPatentes.csv' CSV DELIMITER ';' HEADER ENCODING 'Latin1';


/*Funcion para Patentes Antiguas*/
CREATE OR REPLACE FUNCTION DVPATENTE_A(letras varchar, nums int) RETURNS char as $$
	DECLARE
		valorL integer;
	BEGIN
		valorL := SELECT valor FROM patentes WHERE letras = UPPER(letras)
	END
$$ LANGUAGE plpgsql;

/*Funcion para Patentes Nuevas (Autos y Motos)*/
CREATE OR REPLACE FUNCTION DVPATENTE_N(letras varchar, nums int) RETURNS char as $$
	DECLARE
	BEGIN
	END
$$ LANGUAGE plpgsql;

CREATE OR REPLACE FUNCTION DVPATENTE(patente varchar) RETURNS char as $$
	DECLARE dv char;
	BEGIN
		IF ( UPPER(patente) ~ '[A-Z]{4}[0-9]{2}') THEN
			dv := DVPATENTE_A(SUBSTRING(patente,1,2),SUBSTRING(patente,3,4));
		
		ELSEIF ( UPPER(patente) ~ '[A-Z]{2}[0-9]{4}') THEN
			dv := DVPATENTE_N(SUBSTRING(patente,1,4),SUBSTRING(patente,5,2));
		
		ELSEIF ( UPPER(patente) ~ '[A-Z]{3}[0-9]{2}') THEN
			dv := DVPATENTE_N(SUBSTRING(patente,1,3),SUBSTRING(patente,4,2));
		ELSE
			dv := '-1';
		END IF;
		
		RETURN(dv);
		
	END
$$ LANGUAGE plpgsql;
